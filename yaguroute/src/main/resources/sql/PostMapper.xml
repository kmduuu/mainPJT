<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- SpringBoot 사용시 변경경된 부분 : DaoImpl 을 만들지 않는다.
<mapper namespace="UserMapper10">
-->
<mapper namespace="com.baseball.service.post.PostDao">
 	
	<resultMap id="postSelectMap" type="post">
		<result property="postNo" 				column="post_no" 			jdbcType="INTEGER"/>
		<result property="user.userId"			column="user_id" 			jdbcType="VARCHAR"/>
		<result property="user.userNickName" 	column="user_nickname" 		jdbcType="VARCHAR"/>
		<result property="user.userImage" 		column="user_image" 		jdbcType="VARCHAR"/>
		<result property="teamCode" 			column="team_code" 			jdbcType="VARCHAR"/>
		<result property="postTitle" 			column="post_title" 		jdbcType="VARCHAR"/>
		<result property="postContents" 		column="post_contents" 		jdbcType="LONGVARCHAR"/>
		<result property="postDate" 			column="post_date" 			jdbcType="TIMESTAMP"/>
		<result property="postViews" 			column="post_views" 		jdbcType="INTEGER"/>
		<result property="notice" 				column="notice" 			jdbcType="INTEGER"/>
		<result property="postLikes" 			column="likes" 				jdbcType="INTEGER"/>
		<result property="postDislikes" 		column="dislikes" 			jdbcType="INTEGER"/>
	</resultMap>
	
	<select id="getPost" parameterType="int" resultMap="postSelectMap">
		SELECT * FROM post
		WHERE post_no = #{value}
	</select>
	
	<insert id="addPost" parameterType="post">
	 	INSERT 
		INTO post(user_id, team_code, post_title, post_contents, post_date) 
		VALUES (#{user.userId},#{teamCode},#{postTitle},#{postContents},sysdate())
	</insert>
	
	<delete	id="deletePost" parameterType="int">
	 	DELETE FROM post 
		WHERE post_no = #{value}
	</delete>
	
	<update	id="updatePost"	parameterType="post">
	   	UPDATE post
	   	<set>
	   		post_title 	= #{postTitle},
			post_contents = #{postContents},
			post_type 	=  #{postType},
			notice		= #{notice}
	   	</set>
	   	WHERE post_no = #{postNo}
	</update>
	
	<!-- like_procedure 호출 -->
	<insert id="like" parameterType="post" statementType="CALLABLE">
	    {CALL like_procedure(#{user.userId}, #{postNo})}
	</insert>
	
	<!-- dislike_procedure 호출 -->
	<insert id="dislike" parameterType="post" statementType="CALLABLE">
	    {CALL dislike_procedure(#{user.userId}, #{postNo})}
	</insert>
	
	<select id="getLikes" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM emote WHERE post_no=#{value} AND `like`=1
	</select>
	
	<select id="getDislikes" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM emote WHERE post_no=#{value} AND dislike=1
	</select>
	
	<update id="addViews" parameterType="int">
		UPDATE post SET post_views=post.post_views+1 WHERE post_no=#{value};
	</update>
	
</mapper>
	 